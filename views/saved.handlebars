<nav class="navbar navbar-fixed-top navbar-inverse">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbarNav" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/">
        <div class="logo pull-left">
          <img src="/assets/img/sf_logo.svg" width="30" height="30" alt="">
        </div>
        <span class="navbar-brand pull-left">&nbsp;San Francisco Giants News Scraper</span>
      </a>
    </div>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav nav">
        <li>
          <a href="/">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="active">
          <a href="/saved">Saved Articles</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container main">
  <div class="row">
    <div class="col-md-12">
      <div id="saved-articles"></div>
    </div>
  </div>
</div>

<div class="modal fade" id="scrape-modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="text-center" id="scrape-text"></h3>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  $.get("/articles/saved", function(data) {
    data.forEach(function(val) {
      var link = $("<a>").attr("href", "http://m.mlb.com" + val.url).text(val.heading);
      var heading = $("<h4>").addClass("heading panel-heading").html(link);
      var saveButton = $("<button>").addClass("btn btn-secondary save-button");
      saveButton.attr("type", "button").attr("data-id", val._id).attr("value", false).text("Remove");
      var summary = $("<p>").addClass("summary").text(val.summary);
      var newDiv = $("<div>").addClass("panel panel-default article-div").attr("id", val._id);
      var panelHeading = $("<div>").addClass("panel-heading");
      var panelBody = $("<div>").addClass("panel-body");
      panelHeading.append(heading);
      panelHeading.append(saveButton);
      panelBody.append(summary);
      newDiv.append(panelHeading);
      newDiv.append(panelBody);
      $("#saved-articles").append(newDiv);
    });
  });

  $("#scrape").on("click", function() {
    $.get("/scrape", function(data) {
      $("#scrape-text").text("Added " + data.count + " new articles.");
      $("#scrape-modal").modal("toggle");
    });
  });

  $("body").on("click", ".save-button", function() {
    var id = $(this).attr("data-id")
    var saved = $(this).attr("value");
    var data = { saved: saved }
    $.post("/articles/saved/" + id, data, function(data) {
      console.log(data);
      id = "#" + id;
      $(id).remove();
    });
  });
</script>